# Root Cause Analysis

Step D.2: 원인 분석 (Root Cause Analysis)

## 설명

에러 리포트를 바탕으로 근본 원인을 파악합니다. 에러 메시지를 해석하고, 관련 코드와 설정을 검토하여 문제의 정확한 원인을 찾습니다.

## 트리거

- Step D.1 (Error Capture) 완료 후 자동 실행
- `outputs/debugging/error-report.md` 파일이 존재할 때

## 입력

- `outputs/debugging/error-report.md` - 에러 리포트
- 프로젝트 소스 코드
- 설정 파일 (package.json, tsconfig.json, next.config.js 등)
- 환경 변수 설정 (.env.local, .env.example)

## 실행 내용

### 분석 프로세스

```
1. 에러 메시지 해석
    ↓
2. 스택 트레이스 분석 (있는 경우)
    ↓
3. 관련 파일 검토
    ↓
4. 의존성 확인
    ↓
5. 설정 파일 검토
    ↓
6. 근본 원인 결정
```

### 에러 유형별 분석 포인트

#### Build Error
- [ ] 해당 모듈/파일이 실제로 존재하는지 확인
- [ ] import 경로가 올바른지 확인 (상대/절대 경로, alias)
- [ ] tsconfig.json의 paths 설정 확인
- [ ] package.json의 dependencies 확인
- [ ] node_modules 상태 확인

#### Type Error
- [ ] 타입 정의 위치 확인
- [ ] 예상 타입 vs 실제 타입 비교
- [ ] 제네릭 사용 여부 확인
- [ ] null/undefined 처리 확인
- [ ] 라이브러리 버전과 타입 정의 일치 여부

#### Runtime Error
- [ ] 에러 발생 지점의 코드 검토
- [ ] 변수/객체의 초기화 상태 확인
- [ ] 비동기 처리 흐름 확인
- [ ] 조건문/분기 로직 검토
- [ ] 의존하는 데이터의 유효성 확인

#### Deploy Error
- [ ] 환경 변수 설정 확인 (로컬 vs 프로덕션)
- [ ] 빌드 설정 확인
- [ ] 호스팅 플랫폼 요구사항 확인
- [ ] CORS 설정 확인
- [ ] 도메인/URL 설정 확인

#### Database Error
- [ ] 연결 문자열 확인
- [ ] 네트워크/방화벽 설정 확인
- [ ] 인증 정보 확인
- [ ] 스키마/마이그레이션 상태 확인
- [ ] 쿼리 문법 확인

### 참조 문서 활용

에러 유형에 따라 `references/error-patterns/` 폴더의 문서에서 유사 사례 검색:

| 에러 유형 | 참조 파일 |
|-----------|----------|
| Build | `build-errors.md` |
| Type | `type-errors.md` |
| Runtime | `runtime-errors.md` |
| Deploy | `deploy-errors.md` |
| Database | `database-errors.md` |

### 코드 검토 시 확인 사항

1. **기존 패턴 파악**
   - 프로젝트에서 사용하는 코딩 컨벤션
   - 비슷한 기능이 어떻게 구현되어 있는지
   - import/export 패턴

2. **문제 범위 파악**
   - 이 파일만의 문제인지
   - 여러 파일에 영향을 미치는지
   - 설정 레벨의 문제인지

3. **변경 이력 확인 (가능한 경우)**
   - 최근 수정된 파일
   - 새로 추가된 의존성
   - 설정 변경 사항

### 대화 원칙

- 분석 과정을 사용자에게 공유 ("지금 이 부분을 확인하고 있어요")
- 발견한 내용을 단계적으로 설명
- 기술적 용어는 필요시 쉽게 풀어서 설명
- 원인이 불확실할 경우 정직하게 표현

## 산출물

`outputs/debugging/root-cause.md`

```markdown
# 원인 분석 리포트

## 메타데이터
- Step: D.2 - 원인 분석
- 생성일시: {현재 시간}
- 상태: final

## 에러 요약

**에러 메시지:**
```
{핵심 에러 메시지}
```

**에러 유형:** {유형}

## 분석 결과

### 근본 원인

{근본 원인에 대한 명확한 설명}

### 문제 위치

| 항목 | 값 |
|------|-----|
| 파일 | `{파일 경로}` |
| 라인 | {라인 번호} (해당되는 경우) |
| 함수/컴포넌트 | {이름} |

### 문제 코드

```{언어}
{문제가 되는 코드 조각}
```

### 원인 상세

1. **직접적 원인**: {에러를 직접 유발한 요인}
2. **근본적 원인**: {왜 그런 상황이 발생했는지}
3. **영향 범위**: {이 문제로 인해 영향받는 범위}

### 검토한 항목

- [x] {검토한 항목 1}
- [x] {검토한 항목 2}
- [x] {검토한 항목 3}
- [ ] {추가 확인이 필요한 항목} (해당되는 경우)

## 참조한 문서

- `references/error-patterns/{해당 파일}.md`

## 다음 단계

→ Step D.3: Solution Proposal (해결책 제안)
- 근본 원인을 해결하는 구체적인 방법 제시
- 기존 코드 스타일에 맞는 수정 코드 제안
```

## 완료 조건

- 근본 원인 파악 완료
- 문제가 되는 코드/설정 위치 확인
- 원인에 대한 명확한 설명 작성
- `root-cause.md` 파일이 생성됨

## 다음 Step

→ Step D.3: Solution Proposal (해결책 제안)
