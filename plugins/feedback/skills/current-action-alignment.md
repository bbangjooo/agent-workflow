# Current Action Alignment

현재 작업의 목표 정렬 확인 스킬

## 설명

현재 진행 중이거나 계획된 작업이 프로젝트 목표와 얼마나 정렬되는지 분석합니다. 작업 전에 방향을 확인하여 발산을 사전에 방지합니다.

## 트리거

- `/goal check` 커맨드 실행 시
- 사용자가 "이거 해도 돼?", "방향이 맞아?", "목표랑 맞는지" 요청 시
- 새로운 작업을 시작하기 전 자동 체크 (옵션)

## 입력

- 현재/계획 중인 작업 설명 (사용자 입력 또는 컨텍스트에서 추출)
- `.workflow/state.json`의 goals 배열
- 현재 Phase 정보

## 실행 내용

### 1. 작업 파악

현재 작업이 무엇인지 파악:

```
"어떤 작업을 확인해볼까요?

1. 지금 진행 중인 작업이 있다면 알려주세요
2. 또는 계획 중인 작업을 말씀해주세요

예: '다크모드 추가하려고 해요', '온보딩 플로우 개선 중이에요'"
```

### 2. 목표 로드

`.workflow/state.json`에서 활성 목표 로드

### 3. 정렬 분석

각 목표에 대해 작업의 기여도 분석:

**분석 질문:**
- 이 작업이 목표의 성공 지표에 직접 기여하는가?
- 기여한다면 얼마나 (High/Medium/Low)?
- 간접적 기여인가, 직접적 기여인가?
- 더 직접적인 대안 작업이 있는가?

**기여도 레벨:**

| 레벨 | 정의 | 예시 |
|------|------|------|
| High | 성공 지표에 직접 기여, 15%+ 진척 예상 | "온보딩 완료율 80%" 목표에 "온보딩 플로우 개선" |
| Medium | 간접 기여 또는 5-15% 진척 예상 | 같은 목표에 "버튼 색상 변경" |
| Low | 약한 연관성, 5% 미만 | 같은 목표에 "풋터 디자인 수정" |
| None | 현재 목표와 무관 | "다크모드 추가" (UX 목표 없을 때) |

### 4. 결과 매핑

```yaml
action: "다크모드 추가"
alignment_results:
  - goal_id: "goal-1"
    goal_description: "사용자 첫 경험 3분 내 완료"
    contribution_level: "None"
    reason: "온보딩과 무관한 기능"

  - goal_id: "goal-2"
    goal_description: "핵심 기능 3개 완성"
    contribution_level: "Low"
    reason: "핵심 기능에 포함되지 않음"

overall_alignment: "Weak"
recommendation: "defer"
alternative_actions:
  - "온보딩 튜토리얼 추가 (Goal 1에 High 기여)"
  - "기능 B 버그 수정 (Goal 2에 High 기여)"
```

### 5. 출력 생성

```
🧭 목표 정렬 체크
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

📋 확인할 작업:
"{action_description}"

🎯 목표별 정렬 분석:

{각 목표에 대해}
{alignment_emoji} Goal {n}: {goal_description}
   기여도: {contribution_level}
   이유: {reason}
   {관련 지표가 있으면}
   관련 지표: {indicator}

{목표 끝}

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📊 종합 정렬도: {overall_alignment_emoji} {overall_alignment}

{recommendation에 따른 메시지}
```

### 6. 권장사항 메시지

**Strong/Good 정렬:**
```
✅ 좋은 방향이에요!

이 작업은 목표 달성에 도움이 됩니다.
계속 진행하세요.
```

**Weak 정렬:**
```
⚠️ 재고가 필요해 보여요.

이 작업은 현재 목표와 직접적인 연관이 약해요.

💡 대안 제안:
1. {alternative_1} - Goal {n}에 {level} 기여
2. {alternative_2} - Goal {m}에 {level} 기여

그래도 진행할까요?
1️⃣ 네, 이유가 있어요 (진행)
2️⃣ 대안으로 변경할게요
3️⃣ 나중으로 미룰게요
```

**None 정렬:**
```
❌ 목표와 맞지 않아요.

이 작업은 현재 설정된 어떤 목표에도 기여하지 않아요.

🤔 확인해볼 것:
1. 새로운 목표가 필요한가요? (/goal add)
2. 이 작업은 나중으로 미뤄도 될까요?
3. 기존 목표를 수정해야 할까요? (/goal modify)

💡 목표 정렬된 대안:
1. {alternative_1}
2. {alternative_2}
```

## 산출물

화면 출력 (파일 생성 없음)

사용자 선택에 따라:
- 진행 → 작업 계속
- 대안 선택 → 해당 작업으로 전환
- 미룸 → 백로그에 기록 (선택적)

## 정렬 이모지 매핑

| 정렬도 | 이모지 | 설명 |
|--------|--------|------|
| High | ✅ | 강한 기여 |
| Medium | 🔶 | 중간 기여 |
| Low | ⚠️ | 약한 기여 |
| None | ❌ | 기여 없음 |

| 종합 정렬 | 이모지 |
|-----------|--------|
| Strong | ✅ 매우 좋음 |
| Good | 👍 좋음 |
| Weak | ⚠️ 재고 필요 |
| Misaligned | ❌ 정렬 안 됨 |

## 완료 조건

- 작업-목표 정렬 분석 완료
- 종합 정렬도 판정
- 권장사항 또는 대안 제시
- (Weak/None인 경우) 사용자 결정 수렴

## 주의사항

1. **판단하지 않기**: "이건 안 돼요"가 아닌 "이건 목표와 맞지 않아요"
2. **대안 제시 필수**: 막기만 하지 않고 다른 방향 제안
3. **사용자 자율성 존중**: 최종 결정은 사용자가 함
4. **맥락 고려**: 때로는 목표 외 작업도 필요할 수 있음 (기술 부채 등)
